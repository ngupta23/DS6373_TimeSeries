---
title: "Model Compare Univariate"
author: "Nikhil Gupta"
date: "`r Sys.time()`"
output:
  github_document:
    toc: yes
    toc_depth: '6'
  word_document:
    toc: yes
    toc_depth: '6'
  html_document:
    toc: yes
    toc_depth: 6
    toc_float: yes
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tswge)
library(tswgewrapped)
library(tidyverse)
```


```{r}
source("ModelCompareUnivariate.R")
```

```{r}
data("airlog")

models = list("ARMA Model 1A" = list(phi = c(0.5, 1), theta = c(0.5), sliding_ase = FALSE),
              "ARMA Model 1B" = list(phi = c(0.5, 1), theta = c(0.5), sliding_ase = TRUE),
              "ARMIA Model 2" = list(phi = c(0.5, 1), p = 2, d = 1, sliding_ase = TRUE),
              "ARMUA Model 3" = list(phi = c(0.5, 1), d = 1, s = 12, sliding_ase = TRUE))
```


```{r}
mdl_compare = ModelCompareUnivariate$new(x = airlog, mdl_list = models, n.ahead = 12, batch_size = 60)
```

```{r, warning=FALSE}
mdl_compare$plot_histogram_ases()
```

```{r, warning=FALSE, fig.height=4, fig.width=10}
mdl_compare$plot_forecasts(only_sliding = TRUE)
```

```{r}
mdl_compare$statistical_compare()  
# Only compares models that have sliding_ase calculations, since we need more than 1 result per model
```

```{r}
mdl_compare$get_tabular_metrics(ases = TRUE)
```

```{r}
data = mdl_compare$get_tabular_metrics(ases = FALSE)
data
```

```{r eval=FALSE, fig.height=8, fig.width=10, include=FALSE}
# Just Testing
data_no_realization = data %>% filter(Model != "Realization")
data_only_realization = data %>% filter(Model == "Realization")

p = ggplot() +# data_only_realization, mapping = aes(x=Time, y=ul, color = Model)) + geom_line() +
  #geom_line(data_only_realization, mapping = aes(x=Time, y=ul, color = Model)) +
  #facet_wrap( ~ Model, ncol=2, drop = TRUE) +
  geom_line(data, mapping = aes(x=Time, y=ll, color = Model)) + 
  geom_line(data, mapping = aes(x=Time, y=ul, color = Model)) +
  ylab("Upper and Lower Forecast Limits (95%)")
  
  #geom_ribbon(data, mapping = aes(ymin=ll,ymax=ul), fill="blue", alpha="0.1")
p
```

```{r}

```

